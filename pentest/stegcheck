#!/bin/bash

# A script to run common steganography tools on files, made for CTFs
# Author: ChocolateOverflow

[ $# -eq 0 ] && echo "Usage: stegcheck FILE" && exit

check_manual=0
color_green="\033[32m"
color_red="\033[31m"
color_reset="\033[00m"

# Check binaries
binaries=("snow" "strings" "binwalk")
for bin in "${binaries[@]}"; do
	command -v "${bin}" || echo -e "${color_red}[!] Binary '${bin}' not found${color_reset}" 1>&2
done

steg_text(){
	echo -e "$color_green$ snow -C $f$color_reset"
	snow -C "$1"
	echo
}

steg_bin(){
	echo -e "$color_green$ strings $f | grep -E '(pass|key|hidden|token|secret)'$color_reset"
	strings "$f" | grep -E '(pass|key|hidden|token|secret|\{.*\})'
	echo
	echo -e "$color_green$ binwalk $f$color_reset"
	binwalk "$f"
	echo
}

steg_png(){
	# TODO
  echo 'Not yet implemented'
}

steg_jpg(){
	# TODO
  echo 'Not yet implemented'
}

steg_audio(){
	# TODO
  echo 'Not yet implemented'
}

for f in "$@"; do
	mime=$(file -i "$f" | awk '{print $2}' | cut -d';' -f1)
	echo -e "$color_green$f : $mime$color_reset"
	case $mime in
		text/*) steg_text "$f";;
		audio/*) steg_audio "$f";;
		image/jpeg) steg_jpg "$f";;
		image/png) steg_png "$f";;
		application/x-pie-executable) steg_bin "$f";;
		*) 	echo "File type $mime not supported"
	esac
	echo "===================="
	echo
done
